function rand(){return Random.I.v()}function randF(t,e){return Random.I.f(t,e)}function randI(t,e){return Random.I.i(t,e)}function randBool(){Random.I.bool()}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},GameObject=function(){function t(){this.shape=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.display=e},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t["delete"](),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t["delete"](),!1})},t.prototype["delete"]=function(){this.onDestroy(),this.shape&&(t.display.removeChild(this.shape),this.shape=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Player=function(t){function e(){var i=t.call(this)||this;return i.vx=0,i.vy=0,i.scrollSpeed=0,i.scrollTotal=0,i.hardRate=0,i.state=i.stateNone,e.I=i,i.buttonLR=new ButtonLR,i.radius=BALL_SIZE_PER_WIDTH*Util.width*.5,i.minScrollSpeed=Util.height/960,i.vy=i.minScrollSpeed,i.setShape(.5*Util.width,.3*Util.height,i.radius),i}return __extends(e,t),e.prototype.onDestroy=function(){e.I=null},e.prototype.setShape=function(t,e,i){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,3)):this.shape.graphics.clear(),this.shape.graphics.beginFill(PLAYER_COLOR),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){this.state()},e.prototype.setStateNone=function(){this.state=this.stateNone,this.scrollSpeed=0},e.prototype.stateNone=function(){},e.prototype.stateDrop=function(){var t=this;this.move(),this.scrollSpeed=Math.max(this.vy,this.minScrollSpeed),this.scrollTotal+=this.scrollSpeed,this.hardRate=Util.clamp(this.scrollTotal/(40*Util.height)+Wave.stageHardRate[Game.stage],0,1),console.log("hard "+(100*this.hardRate).toFixed()),this.shape.x+=this.vx,this.shape.y+=this.vy-this.scrollSpeed,this.vx*=.96,this.vy*=.97+.02*this.hardRate,this.vy+=.014*this.radius,Obstacle.obstacles.forEach(function(e){var i=e.shape.x-t.shape.x,s=e.shape.y-t.shape.y,a=Math.pow(i,2)+Math.pow(s,2),n=Math.pow(e.radius+t.radius,2);if(n>a){var o=Math.sqrt(a),r=i/o,h=s/o,l=r*t.vx+h*t.vy;if(l>0){t.vx+=-1.9*l*r,t.vy+=-1.86*l*h;var c=.2*t.radius;o=Math.pow(t.vx,2)+Math.pow(t.vy,2),o<Math.pow(c,2)&&(o=c/Math.sqrt(o),t.vx*=o,t.vy*=o),e.hit()}}}),this.boundWall()},e.prototype.boundWall=function(){var t=this.shape.x-.5*Util.width,e=.5*Util.width-this.radius;Math.pow(t,2)>Math.pow(e,2)&&(this.shape.x=Util.clamp(this.shape.x,this.radius,Util.width-this.radius),this.vx*=-.5),this.vy<0&&this.shape.y<this.radius&&(new GameOver,this.setStateNone())},e.prototype.move=function(){this.buttonLR.left&&(this.vx-=.05*this.radius),this.buttonLR.right&&(this.vx+=.05*this.radius),this.vx=Util.clamp(this.vx,-this.radius,+this.radius)},e.I=null,e}(GameObject);__reflect(Player.prototype,"Player");var BALL_SIZE_PER_WIDTH=1/16,BALL_RADIUS_PER_WIDTH=.5*BALL_SIZE_PER_WIDTH,OBSTACLE_SIZE_PER_WIDTH=1/7,OBSTACLE_RADIUS_PER_WIDTH=.5*OBSTACLE_SIZE_PER_WIDTH,OBSTACLES_IN_HEIGHT=10,SAVE_KEY_BESTSCORE="drop-bestScore",SAVE_KEY_BESTTIME="drop-bestTime",BACK_COLOR=15655644,FONT_COLOR=1195113,PLAYER_COLOR=1195113,OBSTACLE_COLOR=11287393,Game=function(){function t(){}return t.loadSceneTitle=function(){new Title},t.loadSceneGamePlay=function(){0==t.stage?(new ScoreMeter,new Player,new StartMessage,new Wave(t.stage)):(new ScoreTime,new Player,new StartMessage,new Wave(t.stage))},t.stage=0,t}();__reflect(Game.prototype,"Game");var GameClear=function(t){function e(){var e=t.call(this)||this;return e.texts=[],ScoreTime.I.time<ScoreTime.I.bestTime&&(egret.localStorage.setItem(SAVE_KEY_BESTTIME+Game.stage,(100*ScoreTime.I.time).toFixed()),ScoreTime.I.setTextBest()),e.texts[0]=Util.newTextField("CLEAR!",Util.width/11,FONT_COLOR,.5,.45,!0,!1),e.texts[1]=Util.newTextField("TIME : "+ScoreTime.I.textTime.text,Util.width/14,FONT_COLOR,.5,.55,!0,!1),e.texts.forEach(function(t){GameObject.display.addChild(t)}),GameObject.display.once(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.touchBegin(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.touchBegin=function(t){var e=this;GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},this)},e.prototype.tap=function(t){GameObject.transit=Game.loadSceneTitle,this.destroy()},e}(GameObject);__reflect(GameClear.prototype,"GameClear");var ButtonLR=function(t){function e(){var e=t.call(this)||this;return e.left=!1,e.right=!1,e.text=[],e.text[0]=Util.newTextField("◀",Util.width/8,FONT_COLOR,.1,.9,!0,!1),e.text[1]=Util.newTextField("▶",Util.width/8,FONT_COLOR,.9,.9,!0,!1),e.text[0].alpha=.5,e.text[1].alpha=.5,GameObject.display.addChild(e.text[0]),GameObject.display.addChild(e.text[1]),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.touchMove(t)},e),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return e.touchMove(t)},e),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(t){return e.touchEnd(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;GameObject.display.removeChild(this.text[0]),GameObject.display.removeChild(this.text[1]),this.text=null,GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_END,function(e){return t.touchEnd(e)},this)},e.prototype.update=function(){},e.prototype.touchMove=function(t){this.deleteFlag||(t.localX<.5*Util.width?(this.left=!0,this.text[0].alpha=.8,this.right=!1,this.text[1].alpha=.5):(this.right=!0,this.text[1].alpha=.8,this.left=!1,this.text[0].alpha=.5))},e.prototype.touchEnd=function(t){this.deleteFlag||(this.left=!1,this.right=!1,this.text[0].alpha=.5,this.text[1].alpha=.5)},e}(GameObject);__reflect(ButtonLR.prototype,"ButtonLR");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.textGameOver=null,e.textScore=null,e.textGameOver=Util.newTextField("GAME OVER",Util.width/11,FONT_COLOR,.5,.45,!0,!1),GameObject.display.addChild(e.textGameOver),ScoreMeter.I&&(ScoreMeter.I.point>=ScoreMeter.I.bestScore&&egret.localStorage.setItem(SAVE_KEY_BESTSCORE,ScoreMeter.I.point.toFixed()),e.textScore=Util.newTextField("SCORE : "+ScoreMeter.I.point.toFixed()+"m",Util.width/14,FONT_COLOR,.5,.55,!0,!1),GameObject.display.addChild(e.textScore)),GameObject.display.once(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.touchBegin(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.textGameOver),this.textGameOver=null,this.textScore&&(GameObject.display.removeChild(this.textScore),this.textScore=null)},e.prototype.update=function(){},e.prototype.touchBegin=function(t){var e=this;GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},this)},e.prototype.tap=function(t){GameObject.transit=Game.loadSceneTitle,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){GameObject.initial(this.stage),Util.init(this),Game.loadSceneTitle(),egret.startTick(this.tickLoop,this)},e.prototype.tickLoop=function(t){return GameObject.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var Obstacle=function(t){function e(i,s,a){var n=t.call(this)||this;return n.animFrameMax=8,n.animFrame=0,e.obstacles.push(n),n.radius=a,n.setShape(i,s,n.radius),n}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.obstacles=e.obstacles.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e,i){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2)):this.shape.graphics.clear(),this.shape.graphics.beginFill(OBSTACLE_COLOR),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){this.shape.y-=Player.I.scrollSpeed,this.scaleAnim(),this.shape.y+.5*this.radius<=0&&this.destroy()},e.prototype.scaleAnim=function(){if(this.animFrame>0){this.animFrame--;var t=1+.4*this.animFrame/this.animFrameMax;this.shape.scaleX=this.shape.scaleY=t}},e.prototype.hit=function(){this.animFrame=this.animFrameMax,this.radius*=.8,this.setShape(this.shape.x,this.shape.y,this.radius),this.scaleAnim()},e.obstacles=[],e}(GameObject);__reflect(Obstacle.prototype,"Obstacle");var FinishLine=function(t){function e(e){var i=t.call(this)||this;return i.shape=new egret.Shape,GameObject.display.addChild(i.shape),GameObject.display.setChildIndex(i.shape,2),i.shape.graphics.beginFill(OBSTACLE_COLOR),i.shape.graphics.drawRect(-.5*Util.width,-.5*Util.height/200,Util.width,Util.height/200),i.shape.graphics.endFill(),i.shape.x=.5*Util.width,i.shape.y=e,i}return __extends(e,t),e.prototype.update=function(){this.shape.y-=Player.I.scrollSpeed,this.shape.y<=Player.I.shape.y&&(new GameClear,Player.I.setStateNone())},e}(GameObject);__reflect(FinishLine.prototype,"FinishLine");var Random=function(){function t(t){void 0===t&&(t=88675123),this.max=268435455,this.x=123456789,this.y=362436069,this.z=521288629,this.w=t}return t.prototype.v=function(){return(this.next()&this.max)/(this.max+1)},t.prototype.f=function(t,e){return t+this.v()*(e-t)},t.prototype.i=function(t,e){return Math.floor(this.f(t,e))},t.prototype.bool=function(){return 0!=(1&this.next())},t.prototype.next=function(){var t;return t=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(t^t>>>8)},t.I=new t,t}();__reflect(Random.prototype,"Random");var ScoreMeter=function(t){function e(){var i=t.call(this)||this;i.point=0,i.bestScore=0,i.text=null,i.textBest=null,e.I=i,i.point=0,i.text=Util.newTextField("0m",Util.width/22,FONT_COLOR,.5,0,!0,!0),GameObject.display.addChild(i.text);var s=egret.localStorage.getItem(SAVE_KEY_BESTSCORE);return null==s&&(s="50",egret.localStorage.setItem(SAVE_KEY_BESTSCORE,s)),i.bestScore=parseInt(s),i.textBest=Util.newTextField("BEST:"+s+"m",Util.width/22,FONT_COLOR,0,0,!0,!0),GameObject.display.addChild(i.textBest),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null,GameObject.display.removeChild(this.textBest),this.textBest=null,e.I=null},e.prototype.update=function(){this.point+=Player.I.scrollSpeed/Util.height*10,this.text.text=""+this.point.toFixed()+"m",this.bestScore<this.point&&(this.bestScore=this.point,this.textBest.text="BEST:"+this.point.toFixed())},e.prototype.breakBlock=function(){this.point+=1},e.I=null,e}(GameObject);__reflect(ScoreMeter.prototype,"ScoreMeter");var ScoreTime=function(t){function e(){var i=t.call(this)||this;return i.frame=0,i.time=0,i.bestTime=0,i.textTime=null,i.textBest=null,e.I=i,i.frame=0,i.textTime=Util.newTextField("0.00Sec",Util.width/22,FONT_COLOR,.5,0,!0,!0),GameObject.display.addChild(i.textTime),i.setTextBest(),i}return __extends(e,t),e.prototype.setTextBest=function(){var t=egret.localStorage.getItem(SAVE_KEY_BESTTIME+Game.stage);null==t&&(t="9900",egret.localStorage.setItem(SAVE_KEY_BESTTIME+Game.stage,t)),this.bestTime=parseInt(t)/100,this.textBest&&GameObject.display.removeChild(this.textBest),this.textBest=Util.newTextField("BEST:"+this.bestTime.toFixed(2)+"sec",Util.width/22,FONT_COLOR,0,0,!0,!0),GameObject.display.addChild(this.textBest)},e.prototype.onDestroy=function(){GameObject.display.removeChild(this.textTime),this.textTime=null,GameObject.display.removeChild(this.textBest),this.textBest=null,e.I=null},e.prototype.update=function(){(0!=this.frame||Player.I.state!=Player.I.stateNone)&&(this.time+=1/60,this.textTime.text=""+this.time.toFixed(2)+"sec")},e.I=null,e}(GameObject);__reflect(ScoreTime.prototype,"ScoreTime");var StartMessage=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.texts[0]=Util.newTextField("ボールを操作して障害物を避けろ！",Util.width/20,FONT_COLOR,.5,.4,!0,!1),e.texts[1]=Util.newTextField("ボタンで左右に移動",Util.width/20,FONT_COLOR,.5,.5,!0,!1),e.texts.forEach(function(t){GameObject.display.addChild(t)}),GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.tap=function(t){Player.I.state=Player.I.stateDrop,this.destroy()},e}(GameObject);__reflect(StartMessage.prototype,"StartMessage");var Title=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.btnTexts=[],e.btnShapes=[],e.texts[0]=Util.newTextField("DROP",Util.width/10,FONT_COLOR,.5,.2,!0,!1),e.texts[1]=Util.newTextField("ぶつからずに落ちろ！",Util.width/18,FONT_COLOR,.5,.3,!0,!1),e.texts[2]=Util.newTextField("タイムアタックコース",Util.width/18,FONT_COLOR,.5,.7,!0,!1),e.newButton(0,"スタート",Util.width/15,FONT_COLOR,.5,.5,.4,.1),e.newButton(1,"1",Util.width/15,FONT_COLOR,.25,.8,.15,.08),e.newButton(2,"2",Util.width/15,FONT_COLOR,.5,.8,.15,.08),e.newButton(3,"3",Util.width/15,FONT_COLOR,.75,.8,.15,.08),e.texts.forEach(function(t){GameObject.display.addChild(t)}),e.btnTexts.forEach(function(t){GameObject.display.addChild(t)}),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)}),this.btnTexts.forEach(function(t){GameObject.display.removeChild(t)}),this.btnShapes.forEach(function(t){GameObject.display.removeChild(t)}),this.texts=null,this.btnTexts=null,this.btnShapes=null},e.prototype.newButton=function(t,e,i,s,a,n,o,r){var h=this;this.btnTexts[t]=Util.newTextField(e,Util.width/15,BACK_COLOR,a,n,!0,!1);var l=new egret.Shape;GameObject.display.addChild(l),GameObject.display.setChildIndex(l,1),o*=Util.width,r*=Util.height,l.graphics.beginFill(s),l.graphics.drawRect(-.5*o,-.5*r,o,r),l.graphics.endFill(),l.touchEnabled=!0,l.x=a*Util.width,l.y=n*Util.height,l.once(egret.TouchEvent.TOUCH_TAP,function(e){return h.tap(e,t)},this),this.btnShapes[t]=l},e.prototype.update=function(){},e.prototype.tap=function(t,e){Game.stage=e,GameObject.transit=Game.loadSceneGamePlay},e}(GameObject);__reflect(Title.prototype,"Title");var Util=function(){function t(){}return t.init=function(t){this.height=t.stage.stageHeight,this.width=t.stage.stageWidth},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var s=1-i,a=((16711680&t)*s+(16711680&e)*i&16711680)+((65280&t)*s+(65280&e)*i&65280)+((255&t)*s+(255&e)*i&255);return a},t.newTextField=function(e,i,s,a,n,o,r){var h=new egret.TextField;return h.text=e,h.bold=o,h.size=i,h.textColor=s,r?(h.x=(t.width-h.width)*a,h.y=(t.height-h.height)*n):(h.x=t.width*a-.5*h.width,h.y=t.height*n-.5*h.height),h},t}();__reflect(Util.prototype,"Util");var Wave=function(t){function e(i){var s=t.call(this)||this;s.nextWave=0,s.finishLine=null,console.log(i);var a=Date.now();return i>0&&(a=7658*i+1+e.seeds[i-1]),s.rand=new Random(a),s}return __extends(e,t),e.prototype.onDestroy=function(){},e.prototype.update=function(){if(ScoreTime.I&&Player.I.scrollTotal/Util.height*10>=e.stageLength[Game.stage]-10)return void(null==this.finishLine&&(this.finishLine=new FinishLine(Util.height)));for(var t=OBSTACLE_RADIUS_PER_WIDTH*Util.width*2,i=2-1*Player.I.hardRate;this.nextWave<=Player.I.scrollTotal;){this.nextWave+=this.rand.i(1,4)*Util.height/OBSTACLES_IN_HEIGHT;for(var s=this.rand.v()*i;1>s;)new Obstacle(s*Util.width,Util.height+t,t*this.rand.f(.5,1)),s+=this.rand.f(OBSTACLE_SIZE_PER_WIDTH,i)}},e.seeds=[0,0,0,0],e.stageLength=[0,100,150,200],e.stageHardRate=[0,.4,.7,1],e}(GameObject);__reflect(Wave.prototype,"Wave");