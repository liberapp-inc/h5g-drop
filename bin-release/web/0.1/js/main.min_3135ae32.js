function rand(){return Random.I.v()}function randF(t,e){return Random.I.f(t,e)}function randI(t,e){return Random.I.i(t,e)}function randBool(){Random.I.bool()}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var s in e)e.hasOwnProperty(s)&&(t[s]=e[s]);i.prototype=e.prototype,t.prototype=new i},GameObject=function(){function t(){this.shape=null,t.objects.push(this)}return t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.display=e},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t["delete"](),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t["delete"](),!1})},t.prototype["delete"]=function(){this.onDestroy(),this.shape&&(t.display.removeChild(this.shape),this.shape=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var Obstacle=function(t){function e(i,s,a){var r=t.call(this)||this;return r.animFrameMax=8,r.animFrame=0,e.obstacles.push(r),r.radius=a,r.setShape(i,s,r.radius),r}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.obstacles=e.obstacles.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e,i){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,2)):this.shape.graphics.clear(),this.shape.graphics.beginFill(OBSTACLE_COLOR),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){this.shape.y-=Player.I.scrollSpeed,this.scaleAnim(),this.shape.y+.5*this.radius<=0&&this.destroy()},e.prototype.scaleAnim=function(){if(this.animFrame>0){this.animFrame--;var t=1+.2*this.animFrame/this.animFrameMax;this.shape.scaleX=this.shape.scaleY=t}},e.prototype.hit=function(){this.animFrame=this.animFrameMax,this.radius*=.9,this.setShape(this.shape.x,this.shape.y,this.radius),this.scaleAnim()},e.obstacles=[],e}(GameObject);__reflect(Obstacle.prototype,"Obstacle");var EffectCircle=function(t){function e(i,s,a,r){void 0===r&&(r=16760832);var o=t.call(this)||this;return o.frame=e.maxFrame,o.radius=a,o.color=r,o.setShape(i,s,o.radius),o}return __extends(e,t),e.prototype.setShape=function(t,i,s){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape)):this.shape.graphics.clear(),this.shape.x=t,this.shape.y=i,this.shape.graphics.lineStyle(3+10*(this.frame/e.maxFrame),this.color),this.shape.graphics.drawCircle(0,0,s)},e.prototype.update=function(){return--this.frame<=0?void this.destroy():(this.radius*=1.03,void this.setShape(this.shape.x,this.shape.y,this.radius))},e.maxFrame=30,e}(GameObject);__reflect(EffectCircle.prototype,"EffectCircle");var BALL_SIZE_PER_WIDTH=1/16,BALL_RADIUS_PER_WIDTH=.5*BALL_SIZE_PER_WIDTH,OBSTACLE_SIZE_PER_WIDTH=1/8,OBSTACLE_RADIUS_PER_WIDTH=.5*OBSTACLE_SIZE_PER_WIDTH,OBSTACLES_IN_HEIGHT=10,SAVE_KEY_BESTSCORE="drop-bestScore",BACK_COLOR=15655644,FONT_COLOR=1195113,PLAYER_COLOR=1195113,OBSTACLE_COLOR=11287393,Game=function(){function t(){}return t.loadSceneGamePlay=function(){new Background,new Score,new Player,new StartMessage,new Wave(0)},t}();__reflect(Game.prototype,"Game");var Background=function(t){function e(){var e=t.call(this)||this;return e.shape=new egret.Shape,e.shape.graphics.beginFill(BACK_COLOR),e.shape.graphics.drawRect(0,0,Util.width,Util.height),e.shape.graphics.endFill(),GameObject.display.addChild(e.shape),GameObject.display.setChildIndex(e.shape,1),e}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Background.prototype,"Background");var GameOver=function(t){function e(){var e=t.call(this)||this;return e.textGameOver=null,e.textScore=null,e.textGameOver=Util.newTextField("GAME OVER",Util.width/11,FONT_COLOR,.5,.45,!0),GameObject.display.addChild(e.textGameOver),e.textScore=Util.newTextField("SCORE : "+Score.I.point.toFixed()+"m",Util.width/14,FONT_COLOR,.5,.55,!0),GameObject.display.addChild(e.textScore),Score.I.point>=Score.I.bestScore&&egret.localStorage.setItem(SAVE_KEY_BESTSCORE,Score.I.point.toFixed()),GameObject.display.once(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.touchBegin(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.textGameOver),this.textGameOver=null,GameObject.display.removeChild(this.textScore),this.textScore=null},e.prototype.update=function(){},e.prototype.touchBegin=function(t){var e=this;GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},this)},e.prototype.tap=function(t){GameObject.transit=Game.loadSceneGamePlay,this.destroy()},e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){GameObject.initial(this.stage),Util.init(this),Game.loadSceneGamePlay(),egret.startTick(this.tickLoop,this)},e.prototype.tickLoop=function(t){return GameObject.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var ButtonLR=function(t){function e(){var e=t.call(this)||this;return e.left=!1,e.right=!1,e.text=[],e.text[0]=Util.newTextField("◀",Util.width/8,FONT_COLOR,.1,.9,!0),e.text[1]=Util.newTextField("▶",Util.width/8,FONT_COLOR,.9,.9,!0),e.text[0].alpha=.5,e.text[1].alpha=.5,GameObject.display.addChild(e.text[0]),GameObject.display.addChild(e.text[1]),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return e.touchMove(t)},e),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return e.touchMove(t)},e),GameObject.display.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(t){return e.touchEnd(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;GameObject.display.removeChild(this.text[0]),GameObject.display.removeChild(this.text[1]),this.text=null,GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),GameObject.display.stage.removeEventListener(egret.TouchEvent.TOUCH_END,function(e){return t.touchEnd(e)},this)},e.prototype.update=function(){},e.prototype.touchMove=function(t){this.deleteFlag||(t.localX<.5*Util.width?(this.left=!0,this.text[0].alpha=.8,this.right=!1,this.text[1].alpha=.5):(this.right=!0,this.text[1].alpha=.8,this.left=!1,this.text[0].alpha=.5))},e.prototype.touchEnd=function(t){this.deleteFlag||(this.left=!1,this.right=!1,this.text[0].alpha=.5,this.text[1].alpha=.5)},e}(GameObject);__reflect(ButtonLR.prototype,"ButtonLR");var Player=function(t){function e(){var i=t.call(this)||this;return i.vx=0,i.vy=0,i.scrollSpeed=0,i.scrollTotal=0,i.hardRate=0,i.state=i.stateNone,e.I=i,i.buttonLR=new ButtonLR,i.radius=BALL_SIZE_PER_WIDTH*Util.width*.5,i.minScrollSpeed=Util.height/960,i.vy=i.minScrollSpeed,i.setShape(.5*Util.width,.3*Util.height,i.radius),i}return __extends(e,t),e.prototype.onDestroy=function(){e.I=null},e.prototype.setShape=function(t,e,i){null==this.shape?(this.shape=new egret.Shape,GameObject.display.addChild(this.shape),GameObject.display.setChildIndex(this.shape,3)):this.shape.graphics.clear(),this.shape.graphics.beginFill(PLAYER_COLOR),this.shape.graphics.drawCircle(0,0,i),this.shape.graphics.endFill(),this.shape.x=t,this.shape.y=e},e.prototype.update=function(){this.state()},e.prototype.stateNone=function(){},e.prototype.stateDrop=function(){var t=this;this.move(),this.scrollSpeed=Math.max(this.vy,this.minScrollSpeed),this.scrollTotal+=this.scrollSpeed,this.hardRate=Util.clamp(this.scrollTotal/(40*Util.height),0,1),console.log("hard "+(100*this.hardRate).toFixed()),this.shape.x+=this.vx,this.shape.y+=this.vy-this.scrollSpeed,this.vx*=.96,this.vy*=.97+.005*this.hardRate,this.vy+=.014*this.radius,Obstacle.obstacles.forEach(function(e){var i=e.shape.x-t.shape.x,s=e.shape.y-t.shape.y,a=Math.pow(i,2)+Math.pow(s,2),r=Math.pow(e.radius+t.radius,2);if(r>a){var o=Math.sqrt(a),n=i/o,h=s/o,l=n*t.vx+h*t.vy;if(l>0){t.vx+=-1.9*l*n,t.vy+=-1.8*l*h;var c=.2*t.radius;o=Math.pow(t.vx,2)+Math.pow(t.vy,2),o<Math.pow(c,2)&&(o=c/Math.sqrt(o),t.vx*=o,t.vy*=o),e.hit()}}}),this.boundWall()},e.prototype.boundWall=function(){var t=this.shape.x-.5*Util.width,e=.5*Util.width-this.radius;Math.pow(t,2)>Math.pow(e,2)&&(this.shape.x=Util.clamp(this.shape.x,this.radius,Util.width-this.radius),this.vx*=-.5),this.vy<0&&this.shape.y<this.radius&&(new GameOver,this.scrollSpeed=0,this.state=this.stateNone)},e.prototype.move=function(){this.buttonLR.left&&(this.vx-=.05*this.radius),this.buttonLR.right&&(this.vx+=.05*this.radius),this.vx=Util.clamp(this.vx,-this.radius,+this.radius)},e.I=null,e}(GameObject);__reflect(Player.prototype,"Player");var Random=function(){function t(t){void 0===t&&(t=88675123),this.max=268435455,this.x=123456789,this.y=362436069,this.z=521288629,this.w=t}return t.prototype.v=function(){return(this.next()&this.max)/(this.max+1)},t.prototype.f=function(t,e){return t+this.v()*(e-t)},t.prototype.i=function(t,e){return Math.floor(this.f(t,e))},t.prototype.bool=function(){return 0!=(1&this.next())},t.prototype.next=function(){var t;return t=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(t^t>>>8)},t.I=new t,t}();__reflect(Random.prototype,"Random");var Score=function(t){function e(){var i=t.call(this)||this;i.point=0,i.bestScore=0,i.text=null,i.textBest=null,e.I=i,i.point=0,i.text=Util.newTextField("0m",Util.width/22,FONT_COLOR,.5,0,!0),GameObject.display.addChild(i.text);var s=egret.localStorage.getItem(SAVE_KEY_BESTSCORE);return null==s&&(s="50",egret.localStorage.setItem(SAVE_KEY_BESTSCORE,s)),i.bestScore=parseInt(s),i.textBest=Util.newTextField("BEST:"+s+"m",Util.width/22,FONT_COLOR,0,0,!0),GameObject.display.addChild(i.textBest),i}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text),this.text=null,GameObject.display.removeChild(this.textBest),this.textBest=null,e.I=null},e.prototype.update=function(){this.point+=Player.I.scrollSpeed/Util.height*10,this.text.text=""+this.point.toFixed()+"m",this.bestScore<this.point&&(this.bestScore=this.point,this.textBest.text="BEST:"+this.point.toFixed())},e.prototype.breakBlock=function(){this.point+=1},e.I=null,e}(GameObject);__reflect(Score.prototype,"Score");var StartMessage=function(t){function e(){var e=t.call(this)||this;return e.text=[],e.text[0]=Util.newTextField("ボールを操作して障害物を避けろ！",Util.width/20,FONT_COLOR,.5,.4,!0),e.text[1]=Util.newTextField("ボタンで左右に移動",Util.width/20,FONT_COLOR,.5,.5,!0),GameObject.display.addChild(e.text[0]),GameObject.display.addChild(e.text[1]),GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.display.removeChild(this.text[0]),GameObject.display.removeChild(this.text[1]),this.text=null},e.prototype.update=function(){},e.prototype.tap=function(t){Player.I.state=Player.I.stateDrop,this.destroy()},e}(GameObject);__reflect(StartMessage.prototype,"StartMessage");var Title=function(t){function e(){var e=t.call(this)||this;return e.texts=[],e.btnTexts=[],e.btnShapes=[],e.texts[0]=Util.newTextField("DROP",Util.width/10,FONT_COLOR,.5,.2,!0),e.texts[1]=Util.newTextField("ぶつからずに落ちろ！",Util.width/18,FONT_COLOR,.5,.3,!0),e.texts.forEach(function(t){GameObject.display.addChild(t)}),e.btnTexts[0]=Util.newTextField("スタート",Util.width/10,FONT_COLOR,.5,.2,!0),GameObject.display.once(egret.TouchEvent.TOUCH_TAP,function(t){return e.tap(t)},e),e}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.display.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.tap=function(t){Player.I.state=Player.I.stateDrop,this.destroy()},e}(GameObject);__reflect(Title.prototype,"Title");var Util=function(){function t(){}return t.init=function(t){this.height=t.stage.stageHeight,this.width=t.stage.stageWidth},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var s=1-i,a=((16711680&t)*s+(16711680&e)*i&16711680)+((65280&t)*s+(65280&e)*i&65280)+((255&t)*s+(255&e)*i&255);return a},t.newTextField=function(e,i,s,a,r,o){var n=new egret.TextField;return n.text=e,n.bold=o,n.size=i,n.textColor=s,n.x=(t.width-n.width)*a,n.y=(t.height-n.height)*r,n},t}();__reflect(Util.prototype,"Util");var Wave=function(t){function e(i){var s=t.call(this)||this;s.scrollTotal=0,s.next=0;var a=Date.now();return i>0&&(a=7658*i+1+e.seeds[i-1]),s.rand=new Random(a),s}return __extends(e,t),e.prototype.onDestroy=function(){},e.prototype.update=function(){this.scrollTotal+=Player.I.scrollSpeed;for(var t=OBSTACLE_RADIUS_PER_WIDTH*Util.width*2,e=2-1*Player.I.hardRate;this.next<=this.scrollTotal;){this.next+=this.rand.i(1,4)*Util.height/OBSTACLES_IN_HEIGHT;for(var i=this.rand.v()*e;1>i;)new Obstacle(i*Util.width,Util.height+t,t*this.rand.f(.5,1)),i+=this.rand.f(OBSTACLE_SIZE_PER_WIDTH,e)}},e.seeds=[0,0,0,0,0,0,0,0,0,0],e}(GameObject);__reflect(Wave.prototype,"Wave");